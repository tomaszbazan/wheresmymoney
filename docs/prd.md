# Product Requirements Document (PRD) - Where's My Money?!?

## 1. Product Overview

The goal of the project is to create a web application named "Where's My Money?!?" serving as an MVP (Minimum Viable
Product) for household budget management. The application aims to drastically reduce the time required for recording
expenses and income by automating the bank data import process and utilizing artificial intelligence (Gemini 1.5 Flash)
for automatic transaction categorization.

The product is targeted at individual users and families who want to manage their finances jointly, specifically those
using mBank accounts. The application emphasizes speed, interface simplicity (Flutter), and data security (no storage of
sensitive bank credentials/account numbers).

## 2. User Problem

Currently, the process of tracking a household budget using traditional methods (notebooks, spreadsheets) is:

- **Time-consuming:** Requires manual transcription of data from bank history.
- **Error-prone:** Manual entry of amounts and dates leads to mistakes.
- **Inconvenient:** Discourages regular budget tracking.

Users need a tool that removes the burden of mechanical data entry, allowing them to focus on controlling expenses while
offering flexibility in defining their own expense structure (categories).

## 3. Functional Requirements

### Authentication and Groups

- User registration and login (external identity provider).
- Creation of family groups (Shared Workspace).
- Generation and handling of invitation codes for groups (one user belongs to one group).

### Category Management

- Full CRUD (Create, Read, Update, Delete) for categories.
- Support for a tree structure of categories up to 5 levels deep.
- Blocking of transaction addition if no categories are defined.
- Blocking of category deletion if transactions are assigned to it.

### Import and Data Processing

- Import of CSV files generated by mBank (individual clients).
- File parsing and validation.
- Processing of transactions in browser RAM before saving (no temporary persistence).
- Transaction deduplication mechanism based on data hashing.

### AI Integration

- Utilization of the Gemini 1.5 Flash model.
- Sending transaction descriptions and the user's category tree to the model.
- Receiving suggested categories for each transaction.
- AI operates statelessly (does not learn from user corrections).

### Transaction Management

- Preview of imported transactions before saving.
- Manual category editing (Searchable Dropdown) and other data adjustments.
- Saving transactions to the PostgreSQL database.
- Ability to manually add transactions outside of the import process.
- Editing and deleting (Hard Delete) of saved transactions.
- Support for PLN currency only (amounts in other currencies are treated as PLN numbers).

## 4. Product Boundaries

### In-Scope

- Web Application (Web First).
- Frontend: Flutter.
- Backend: Java + Spring.
- Database: PostgreSQL.
- Import: mBank CSV files only.
- Categorization: Gemini 1.5 Flash.
- Currency: PLN only.

### Out-of-Scope

- Native iOS/Android applications.
- Support for imports from banks other than mBank.
- Automatic bank synchronization (PSD2 API).
- Multi-currency support and exchange rate conversions.
- Advanced analytics and charts.
- Machine learning (fine-tuning) based on user behavior.
- Storage of bank account numbers.

## 5. User Stories

### Authentication and Account Management

**ID:** TASK-0001
**Title:** System Login
**Description:** As a user, I want to log in to the application using a secure mechanism to access my financial data.
**Acceptance Criteria:**

1. User sees a login/registration form.
2. System verifies the correctness of credentials.
3. Upon successful login, the user is redirected to the main application view.
4. Upon failed login, an appropriate error message is displayed.

**ID:** TASK-0002
**Title:** Family Group Creation
**Description:** As a new user, I want to automatically create a new group (family) upon registration so that I can
start gathering data within it.
**Acceptance Criteria:**

1. Upon first registration, the system creates a unique group for the user.
2. The user is automatically assigned to this group as an administrator/owner.

**ID:** TASK-0003
**Title:** Joining a Group via Invitation Code
**Description:** As a head of the family, I want to generate an invitation code, and as a spouse, I want to use it so we
can manage a joint budget.
**Acceptance Criteria:**

1. A user can generate a unique invitation code in the group settings.
2. A new user can enter the invitation code during registration or in their profile.
3. Upon entering a valid code, the user is added to the existing group.
4. The user has access to the same data as other group members.

### Category Management

**ID:** TASK-0004
**Title:** Category Initialization and Addition
**Description:** As a user, I want to create my own category tree because the system starts with an empty list, and
categories are required to enter transactions.
**Acceptance Criteria:**

1. The system has an empty category list upon startup for a new account.
2. The add/import transaction button is inactive (disabled) if the category list is empty.
3. User can add a main category.
4. User can add a subcategory to an existing category (up to 5 levels deep).
5. Category names within a single parent must be unique.

**ID:** TASK-0005
**Title:** Category Deletion with Validation
**Description:** As a user, I want to delete a category only if it is not in use to maintain data consistency.
**Acceptance Criteria:**

1. User can select an option to delete a category.
2. System checks if the category (or its subcategories) has any assigned transactions.
3. If transactions exist, the system blocks deletion and displays an error message.
4. If there are no transactions, the category is removed from the tree.

### Import and AI

**ID:** TASK-0006
**Title:** mBank CSV File Import
**Description:** As a user, I want to upload a CSV file downloaded from mBank so the system can process my expenses.
**Acceptance Criteria:**

1. User can select a file from the local drive.
2. System validates the file format (checks if it is an mBank CSV).
3. System rejects files with incorrect structure.
4. After loading, data is parsed into the browser's RAM.
5. User sees a progress bar or processing information.

**ID:** TASK-0007
**Title:** Automatic AI Categorization
**Description:** As a user, I want the system to automatically assign categories to imported transactions so I don't
have to do it manually.
**Acceptance Criteria:**

1. System sends transaction descriptions and the current category tree to Gemini 1.5 Flash.
2. System receives suggested categories.
3. Each transaction on the temporary list has a pre-filled category.
4. If AI cannot find a matching category, the category field remains empty or is marked as "To be clarified".

### Transaction Review and Edit

**ID:** TASK-0008
**Title:** Staging List Verification and Edit
**Description:** As a user, I want to review transactions before saving them and correct AI errors, keeping in mind that
refreshing the page will delete my work.
**Acceptance Criteria:**

1. A list of imported transactions stored in RAM is displayed.
2. User can manually change the category for any transaction using a Searchable Dropdown.
3. User can edit the description, date, and amount of the transaction.
4. Refreshing the page causes the loss of unsaved data (list clears) - no "draft" mechanism.

**ID:** TASK-0009
**Title:** Transaction Saving and Deduplication
**Description:** As a user, I want to approve the import so that transactions are permanently saved to the database,
avoiding duplicates.
**Acceptance Criteria:**

1. User clicks "Save/Approve".
2. System calculates a hash for each transaction to detect duplicates.
3. Transactions that already exist in the database (identical hash) are skipped (or the user is informed).
4. New transactions are saved to the PostgreSQL database.
5. Browser RAM is cleared after a successful save.

### Manual Management and Data Editing

**ID:** TASK-0010
**Title:** Manual Transaction Addition
**Description:** As a user, I want to manually add a cash expense that does not appear in the bank.
**Acceptance Criteria:**

1. A form for adding a single transaction is available.
2. Fields: Date, Amount (PLN), Category (required), Description.
3. Addition is blocked if no categories are defined.
4. Transaction is saved to the database.

**ID:** TASK-0011
**Title:** Editing Saved Transaction and Duplicate Risk
**Description:** As a user, I want to be able to edit the date and amount of a saved transaction, accepting the risk
that re-importing the same transaction may create a duplicate.
**Acceptance Criteria:**

1. User can edit any field of a saved transaction (Date, Amount, Category, Description).
2. When editing Date or Amount (key to the deduplication hash), the system may display a warning: "Changing these
   details may result in this transaction being re-imported as new in the future".
3. Changes are saved to the database.

**ID:** TASK-0012
**Title:** Permanent Transaction Deletion
**Description:** As a user, I want to delete an erroneous transaction so that my budget balances correctly.
**Acceptance Criteria:**

1. User can select a transaction to delete.
2. System performs a "Hard Delete" (physically removes the record from the database).
3. The balance/list view updates immediately.

## 6. Success Metrics

The success of the project in the MVP phase will be measured by the following criteria:

1. **Functional MVP Delivery:** The application enables the full user flow: Registration -> Category Creation -> CSV
   Import -> AI Categorization -> Save to Database.
2. **Import Effectiveness:** Users are able to correctly import a file from mBank without technical application errors (
   assuming a valid source file).
3. **Stability of Categorization:** The AI model returns matching categories from the user's tree (no technical errors
   in communication with the Gemini API).
4. **Data Security:** No incidents regarding data leaks or unauthorized access between groups.